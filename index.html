<html>
<head>
	<title>Keyboard inputs in JavaScript</title>
</head>
<body>   
	<script>
		var Keyboard = {};
		var Game = {};
		Keyboard.pressedKeys = [];
		Keyboard.allowedKeys = [65, 68, 83, 87];  		// WASD-keys. For i18n this should be changeable
		Game.mappedAction = ['l', 'r', 'd', 'u'];		// map these actions with "allowedKeys"-array
		Game.currentActions = [];
		document.onkeydown = processKeyDownEvent;
		document.onkeyup = processKeyUpEvent;

		function processKeyDownEvent(e){
			if(!Keyboard.pressedKeys[e.which] && isAllowedKey(e.which) ){
				Keyboard.pressedKeys[e.which] = 1;
				sendCurrentActionsToServer()
			}
		}

		function processKeyUpEvent(e){
			if(isAllowedKey(e.which) ){
				Keyboard.pressedKeys[e.which] = 0;
				sendCurrentActionsToServer()
			}
		}
		
		function isAllowedKey(key){
			if(Keyboard.allowedKeys.indexOf(key) != -1){
			 return true;
			}
			return false;
		}
		
		function sendCurrentActionsToServer(){
			for(var i=0; i < Keyboard.allowedKeys.length; i++){
				if(Keyboard.pressedKeys[Keyboard.allowedKeys[i]]){
					Game.currentActions.push(Game.mappedAction[i]);
				}	
			}
			// if all keys have been released, send "null" instead of empty array
			if(Game.currentActions.length == 0){
				Game.currentActions.push("null");
			}
			
			console.log("Sending these actions to the server: ", Game.currentActions);
			Game.currentActions = [];  // clear array
		}

	</script>
</body>
</html>


